{% extends "auctions/layout.html" %}
{% block title %}{{ auction.title }}{% endblock %}
{% block body %}

<div class="container h-100">
    {% if owner%}
        <div class="row" >
            {% if message %}
                <h2>{{ message }}</h2>
            {% endif %}
        </div>
    {% endif %}
    <div class="row border border-secondary rounded bg-white">
        <div class="col-4 mt-3">
            {% if auction.image_url %}
                <img class="card-img-top detail_image" src="{{ auction.image_url }}" alt="Card image cap">
            {% else %}
                <img class="card-img-top detail_image_no_image" src="https://img.icons8.com/officel/16/000000/no-image.png" alt="Card image cap">
            {% endif %}
        </div>
        <div class="col-8 border-left border-secondary py-3">
            <h2>{{ auction.title }}</h2>
            <small class="text-muted">{{ auction.category.category}}</small>
            <div class="detail_description border-top border-bottom border-secondary py-3 mb-3 ">
                <p>{{ auction.description }}</p>            </div>

            <div class="row">
                <div class="col-3 d-flex align-items-center">   
                    <h6>Current Bid: ${{ auction.current_bid }}</h6>
                </div>
                {% if user.is_authenticated %}
                    <div class="col-3 d-flex align-items-center">
                        {% if auction.current_bid.user %}
                            <h6>Ahead: @{{ auction.current_bid.user.username }}</h6>
                        {% endif %}
                    </div>

                    <div class="col-6"> 
                        {% if not owner and auction.active%}
                            <form method="POST" action="{% url 'detail_auction' auction.id %}">
                                {% csrf_token %}
                                <div class="input-group mb-3">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text">$</span>
                                    </div>
                                    <input type="number" hidden value="1" name="option">
                                    <input name="bid" type="number" step="0.50" min="{{ min_bid }}" class="form-control" required>
                                    <div class="input-group-append">
                                        <input type="submit" class="input-group-text btn btn-sm btn-outline-primary" value="push bid">
                                    </div>
                                </div>
                            </form>
                        {% endif %}  
                    </div>
                {% endif %}
            </div>

        </div>
    </div>
    {% if user.is_authenticated %}
        <div class="row">
            <div class="p-0 col">
                <div class="d-flex justify-content-between my-4">
                    <h1>Comments</h1>   
                    {% if auction.active %}
                        {% if user.is_authenticated %}
                            {% if owner %}
                                <div>
                                    <a href="{% url 'delete_auction' auction.id %}" class="btn btn-danger btn-lg">Delete auction</a>
                                    <a href="{% url 'end_auction' auction.id %}" class="btn btn-primary btn-lg">End auction</a>
                                </div>
                            {% endif %}
                            <div>
                                {% if is_in_watchlist %}
                                    <a href="{% url 'delete_from_watchlist' auction.id %}" class="btn btn-primary btn-lg">Delete this auction from @{{user.username}} watchlist</a>
                                {% else %}
                                    <a href="{% url 'add_to_watchlist' auction.id %}" class="btn btn-primary btn-lg">Add to @{{user.username}} watchlist</a>
                                {% endif %}
                            </div>
                        {% endif %}
                    {% else %}
                        <h4>Waiting for winner confirmation</h4>
                    {% endif %}
                </div>
                <form method='POST' action={% url 'detail_auction' auction.id %}>
                    {% csrf_token %}
                    <div class="input-group mb-3">
                        <textarea rows="2" class="form-control" placeholder="What are you thinking?" name="comment_text"></textarea>
                        <div class="input-group-append">
                            <input type="submit" class="btn btn-outline-primary" value="send">
                        </div>
                    </div>
                    <input type="number" hidden value="2" name="option">
                </form>
                <div class="list-group comments comments_bg">
                    {% for comment in comments %}
                        <div class="list-group-item">
                            <div class="w-100">
                                <small class="text-muted">@{{ comment.user.username }} ({{ comment.datetime }})</small>
                                <p>{{ comment }}</p>
                            </div>
                        </div>

                        {% empty %}
                            <p>No comments... yet</p>
                    {% endfor %}
                </div>
            </div>
        </div>
    {% endif %}
</div>
 
{% endblock %}